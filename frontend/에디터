import React, { useState, useEffect, useMemo } from 'react';
import {
    Container,
    Text,
    Stack,
    Group,
    Button,
    TextInput,
    Textarea,
    Select,
    MultiSelect,
    Paper,
    Box,
    ActionIcon,
    Badge,
    Card,
    Divider,
    Switch,
    Tooltip,
    Progress,
    Affix,
    Transition,
    FileInput,
    Image,
    useComputedColorScheme,
    useMantineColorScheme,
    Tabs,
    Alert,
    LoadingOverlay,
    Modal,
    Grid,
    Title,
    Avatar,
    Center
} from '@mantine/core';
import { RichTextEditor, Link } from '@mantine/tiptap';
import { useEditor } from '@tiptap/react';
import Highlight from '@tiptap/extension-highlight';
import StarterKit from '@tiptap/starter-kit';
import Underline from '@tiptap/extension-underline';
import TextAlign from '@tiptap/extension-text-align';
import Superscript from '@tiptap/extension-superscript';
import SubScript from '@tiptap/extension-subscript';
import CodeBlockLowlight from '@tiptap/extension-code-block-lowlight';
import { CodeHighlight } from '@mantine/code-highlight';
import { createLowlight } from 'lowlight';
import ts from 'highlight.js/lib/languages/typescript';
import javascript from 'highlight.js/lib/languages/javascript';
import python from 'highlight.js/lib/languages/python';
import java from 'highlight.js/lib/languages/java';
import css from 'highlight.js/lib/languages/css';
import html from 'highlight.js/lib/languages/xml';
import {
    IconDeviceFloppy,
    IconEye,
    IconSun,
    IconMoon,
    IconCode,
    IconPhoto,
    IconTag,
    IconCategory,
    IconArrowUp,
    IconSparkles,
    IconRobot,
    IconBrandGithub,
    IconCopy,
    IconCheck,
    IconAlertCircle,
    IconInfoCircle,
    IconX
} from '@tabler/icons-react';
import { useForm } from '@mantine/form';
import { notifications } from '@mantine/notifications';

// Lowlight ÏÑ§Ï†ï (code highlighting)
const lowlight = createLowlight();
lowlight.register({ ts, javascript, python, java, css, html });

// 2025ÎÖÑ Ìä∏Î†åÎìú Î∞òÏòÅ: AI Í∏∞Î∞ò ÌÉúÍ∑∏ Ï†úÏïà ÏãúÎÆ¨Î†àÏù¥ÏÖò
const suggestedTags = [
    'React', 'TypeScript', 'JavaScript', 'Next.js', 'Node.js',
    'ÏõπÍ∞úÎ∞ú', 'ÌîÑÎ°†Ìä∏ÏóîÎìú', 'Î∞±ÏóîÎìú', 'UI/UX', 'ÎîîÏûêÏù∏',
    '2025Ìä∏Î†åÎìú', 'AI', 'Î®∏Ïã†Îü¨Îãù', 'Îç∞Ïù¥ÌÑ∞Î∂ÑÏÑù', 'ÏÑ±Îä•ÏµúÏ†ÅÌôî',
    'Ï†ëÍ∑ºÏÑ±', 'Î∞òÏùëÌòïÏõπ', 'PWA', 'ÏÑúÎ≤ÑÏÇ¨Ïù¥ÎìúÎ†åÎçîÎßÅ', 'API',
    'Spring Boot', 'Java', 'Spring Framework', 'Mantine'
];

const categories = [
    { value: 'tech', label: 'üíª Í∏∞Ïà†' },
    { value: 'design', label: 'üé® ÎîîÏûêÏù∏' },
    { value: 'frontend', label: '‚öõÔ∏è ÌîÑÎ°†Ìä∏ÏóîÎìú' },
    { value: 'backend', label: 'üîß Î∞±ÏóîÎìú' },
    { value: 'tutorial', label: 'üìö ÌäúÌÜ†Î¶¨Ïñº' },
    { value: 'review', label: '‚≠ê Î¶¨Î∑∞' },
    { value: 'news', label: 'üì∞ Îâ¥Ïä§' },
    { value: 'career', label: 'üíº Ïª§Î¶¨Ïñ¥' },
    { value: 'trends', label: 'üöÄ Ìä∏Î†åÎìú' }
];

// 2025ÎÖÑ Ìä∏Î†åÎìú: Ïú†Í∏∞Ï†Å ÌòïÌÉúÏôÄ Í∏ÄÎûòÏä§Î™®ÌîºÏ¶òÏùÑ Î∞òÏòÅÌïú ÌîåÎ°úÌåÖ Ìà¥Î∞î
function FloatingToolbar({ onSave, onPreview, isDraft, saveProgress }) {
    const computedColorScheme = useComputedColorScheme('light');
    const [showScrollTop, setShowScrollTop] = useState(false);

    useEffect(() => {
        const handleScroll = () => {
            setShowScrollTop(window.scrollY > 300);
        };
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
    }, []);

    const scrollToTop = () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    return (
        <Affix position={{ bottom: 20, right: 20 }}>
            <Stack gap="xs">
                {/* Ï†ÄÏû• ÏßÑÌñâÎ•† ÌëúÏãú */}
                {saveProgress > 0 && (
                    <Paper
                        p="sm"
                        style={{
                            background: computedColorScheme === 'light'
                                ? 'rgba(255, 255, 255, 0.95)'
                                : 'rgba(20, 20, 20, 0.95)',
                            backdropFilter: 'blur(20px)',
                            border: computedColorScheme === 'light'
                                ? '1px solid rgba(0, 0, 0, 0.1)'
                                : '1px solid rgba(255, 255, 255, 0.1)',
                            borderRadius: '16px',
                            boxShadow: computedColorScheme === 'light'
                                ? '0 8px 32px rgba(0, 0, 0, 0.12)'
                                : '0 8px 32px rgba(255, 255, 255, 0.05)',
                            width: '200px'
                        }}
                    >
                        <Text size="xs" mb="xs">Ï†ÄÏû• Ï§ë...</Text>
                        <Progress value={saveProgress} size="xs" radius="xl" />
                    </Paper>
                )}

                {/* Î©îÏù∏ Ïï°ÏÖò Î≤ÑÌäºÎì§ */}
                <Paper
                    p="xs"
                    style={{
                        background: computedColorScheme === 'light'
                            ? 'rgba(255, 255, 255, 0.95)'
                            : 'rgba(20, 20, 20, 0.95)',
                        backdropFilter: 'blur(20px)',
                        border: computedColorScheme === 'light'
                            ? '1px solid rgba(0, 0, 0, 0.1)'
                            : '1px solid rgba(255, 255, 255, 0.1)',
                        borderRadius: '16px',
                        boxShadow: computedColorScheme === 'light'
                            ? '0 8px 32px rgba(0, 0, 0, 0.12)'
                            : '0 8px 32px rgba(255, 255, 255, 0.05)'
                    }}
                >
                    <Stack gap="xs">
                        <Tooltip label="ÎØ∏Î¶¨Î≥¥Í∏∞" position="left">
                            <ActionIcon
                                variant="light"
                                size="lg"
                                onClick={onPreview}
                                style={{
                                    transition: 'all 0.2s ease',
                                    background: 'rgba(34, 139, 230, 0.1)',
                                    '&:hover': {
                                        background: 'rgba(34, 139, 230, 0.2)',
                                        transform: 'scale(1.1)'
                                    }
                                }}
                            >
                                <IconEye size={20} />
                            </ActionIcon>
                        </Tooltip>

                        <Tooltip label={isDraft ? "ÏûÑÏãúÏ†ÄÏû•" : "Î∞úÌñâÌïòÍ∏∞"} position="left">
                            <ActionIcon
                                variant="filled"
                                size="lg"
                                onClick={onSave}
                                style={{
                                    background: isDraft
                                        ? 'linear-gradient(135deg, var(--mantine-color-orange-6), var(--mantine-color-yellow-6))'
                                        : 'linear-gradient(135deg, var(--mantine-color-green-6), var(--mantine-color-teal-6))',
                                    transition: 'all 0.2s ease',
                                    '&:hover': {
                                        transform: 'scale(1.1)'
                                    }
                                }}
                            >
                                <IconDeviceFloppy size={20} color="white" />
                            </ActionIcon>
                        </Tooltip>
                    </Stack>
                </Paper>

                {/* Îß® ÏúÑÎ°ú Î≤ÑÌäº - 2025 Ìä∏Î†åÎìú: ÎßàÏù¥ÌÅ¨Î°ú Ïï†ÎãàÎ©îÏù¥ÏÖò */}
                <Transition mounted={showScrollTop} transition="slide-up" duration={200}>
                    {(styles) => (
                        <ActionIcon
                            style={{
                                ...styles,
                                background: 'linear-gradient(135deg, var(--mantine-color-violet-6), var(--mantine-color-grape-6))',
                                backdropFilter: 'blur(20px)',
                                borderRadius: '50%',
                                boxShadow: computedColorScheme === 'light'
                                    ? '0 8px 32px rgba(0, 0, 0, 0.12)'
                                    : '0 8px 32px rgba(255, 255, 255, 0.05)',
                                transition: 'all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)'
                            }}
                            size="xl"
                            onClick={scrollToTop}
                        >
                            <IconArrowUp size={24} color="white" />
                        </ActionIcon>
                    )}
                </Transition>
            </Stack>
        </Affix>
    );
}

// 2025ÎÖÑ Ìä∏Î†åÎìú: AI ÏßÄÏõê Ïª¥Ìè¨ÎÑåÌä∏
function AIAssistant({ onSuggestTags, onSuggestTitle, onOptimizeContent, isLoading }) {
    const computedColorScheme = useComputedColorScheme('light');
    const [isExpanded, setIsExpanded] = useState(false);

    return (
        <Card
            p="md"
            style={{
                background: computedColorScheme === 'light'
                    ? 'linear-gradient(135deg, rgba(67, 56, 202, 0.05), rgba(147, 51, 234, 0.05))'
                    : 'linear-gradient(135deg, rgba(67, 56, 202, 0.1), rgba(147, 51, 234, 0.1))',
                border: computedColorScheme === 'light'
                    ? '1px solid rgba(67, 56, 202, 0.2)'
                    : '1px solid rgba(147, 51, 234, 0.2)',
                borderRadius: '16px',
                position: 'relative',
                overflow: 'hidden'
            }}
        >
            <LoadingOverlay visible={isLoading} />

            <Group justify="space-between" mb="md">
                <Group>
                    <Avatar
                        size="sm"
                        style={{
                            background: 'linear-gradient(135deg, var(--mantine-color-violet-6), var(--mantine-color-grape-6))',
                        }}
                    >
                        <IconRobot size={16} color="white" />
                    </Avatar>
                    <Text fw={600} size="sm">AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏</Text>
                    <Badge variant="light" color="violet" size="xs">
                        Beta
                    </Badge>
                </Group>
                <ActionIcon
                    variant="subtle"
                    onClick={() => setIsExpanded(!isExpanded)}
                >
                    <IconSparkles size={16} />
                </ActionIcon>
            </Group>

            <Transition mounted={isExpanded} transition="slide-down" duration={200}>
                {(styles) => (
                    <div style={styles}>
                        <Text size="xs" c="dimmed" mb="md">
                            AIÍ∞Ä ÎãπÏã†Ïùò Í∏ÄÏì∞Í∏∞Î•º ÎèÑÏôÄÎìúÎ¶ΩÎãàÎã§
                        </Text>

                        <Stack gap="xs">
                            <Button
                                variant="light"
                                size="xs"
                                leftSection={<IconTag size={14} />}
                                onClick={onSuggestTags}
                                fullWidth
                            >
                                ÌÉúÍ∑∏ Ï†úÏïàÎ∞õÍ∏∞
                            </Button>
                            <Button
                                variant="light"
                                size="xs"
                                leftSection={<IconSparkles size={14} />}
                                onClick={onSuggestTitle}
                                fullWidth
                            >
                                Ï†úÎ™© Í∞úÏÑ†ÌïòÍ∏∞
                            </Button>
                            <Button
                                variant="light"
                                size="xs"
                                leftSection={<IconCheck size={14} />}
                                onClick={onOptimizeContent}
                                fullWidth
                            >
                                ÎÇ¥Ïö© ÏµúÏ†ÅÌôî
                            </Button>
                        </Stack>
                    </div>
                )}
            </Transition>
        </Card>
    );
}

// ÏΩîÎìú Î∏îÎ°ù ÏÇΩÏûÖ Î™®Îã¨
function CodeBlockModal({ opened, onClose, onInsert }) {
    const [language, setLanguage] = useState('javascript');
    const [code, setCode] = useState('');

    const languages = [
        { value: 'javascript', label: 'JavaScript' },
        { value: 'typescript', label: 'TypeScript' },
        { value: 'python', label: 'Python' },
        { value: 'java', label: 'Java' },
        { value: 'css', label: 'CSS' },
        { value: 'html', label: 'HTML' },
        { value: 'json', label: 'JSON' },
        { value: 'bash', label: 'Bash' }
    ];

    const handleInsert = () => {
        onInsert(code, language);
        setCode('');
        onClose();
    };

    return (
        <Modal
            opened={opened}
            onClose={onClose}
            title="ÏΩîÎìú Î∏îÎ°ù ÏÇΩÏûÖ"
            size="lg"
            style={{
                backdropFilter: 'blur(10px)'
            }}
        >
            <Stack gap="md">
                <Select
                    label="Ïñ∏Ïñ¥ ÏÑ†ÌÉù"
                    data={languages}
                    value={language}
                    onChange={setLanguage}
                />

                <Textarea
                    label="ÏΩîÎìú"
                    placeholder="Ïó¨Í∏∞Ïóê ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
                    value={code}
                    onChange={(e) => setCode(e.target.value)}
                    rows={10}
                    style={{
                        fontFamily: 'Monaco, Menlo, "Ubuntu Mono", monospace'
                    }}
                />

                {code && (
                    <Box>
                        <Text size="sm" fw={500} mb="xs">ÎØ∏Î¶¨Î≥¥Í∏∞:</Text>
                        <CodeHighlight
                            code={code}
                            language={language}
                            radius="md"
                        />
                    </Box>
                )}

                <Group justify="flex-end">
                    <Button variant="light" onClick={onClose}>
                        Ï∑®ÏÜå
                    </Button>
                    <Button onClick={handleInsert} disabled={!code.trim()}>
                        ÏÇΩÏûÖ
                    </Button>
                </Group>
            </Stack>
        </Modal>
    );
}

// Î©îÏù∏ PostEditForm Ïª¥Ìè¨ÎÑåÌä∏
export default function PostEditForm() {
    const { colorScheme, toggleColorScheme } = useMantineColorScheme();
    const computedColorScheme = useComputedColorScheme('light');

    const [saveProgress, setSaveProgress] = useState(0);
    const [isAILoading, setIsAILoading] = useState(false);
    const [codeModalOpened, setCodeModalOpened] = useState(false);
    const [previewModalOpened, setPreviewModalOpened] = useState(false);
    const [selectedTags, setSelectedTags] = useState([]);
    const [isDraft, setIsDraft] = useState(true);

    // Mantine Form ÏÑ§Ï†ï
    const form = useForm({
        initialValues: {
            title: '',
            subtitle: '',
            content: '',
            category: '',
            tags: [],
            bannerImage: null,
            metaDescription: '',
            isPublished: false
        },
        validate: {
            title: (value) => (!value ? 'Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî' : null),
            category: (value) => (!value ? 'Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî' : null),
            content: (value) => (!value ? 'ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî' : null)
        }
    });

    // Rich Text Editor ÏÑ§Ï†ï
    const editor = useEditor({
        extensions: [
            StarterKit,
            Underline,
            Link,
            Superscript,
            SubScript,
            Highlight,
            TextAlign.configure({ types: ['heading', 'paragraph'] }),
            CodeBlockLowlight.configure({
                lowlight,
                defaultLanguage: 'javascript'
            })
        ],
        content: form.values.content,
        onUpdate: ({ editor }) => {
            form.setFieldValue('content', editor.getHTML());
        }
    });

    // AI Í∏∞Îä•Îì§ (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
    const handleAISuggestTags = async () => {
        setIsAILoading(true);
        await new Promise(resolve => setTimeout(resolve, 1500)); // Î°úÎî© ÏãúÎÆ¨Î†àÏù¥ÏÖò

        const aiSuggested = suggestedTags
            .sort(() => 0.5 - Math.random())
            .slice(0, 5);

        setSelectedTags(prev => [...new Set([...prev, ...aiSuggested])]);
        form.setFieldValue('tags', [...new Set([...form.values.tags, ...aiSuggested])]);

        notifications.show({
            title: 'AI ÌÉúÍ∑∏ Ï†úÏïà',
            message: `${aiSuggested.length}Í∞úÏùò ÌÉúÍ∑∏Í∞Ä Ï†úÏïàÎêòÏóàÏäµÎãàÎã§!`,
            color: 'violet'
        });
        setIsAILoading(false);
    };

    const handleAISuggestTitle = async () => {
        setIsAILoading(true);
        await new Promise(resolve => setTimeout(resolve, 1000));

        const suggestions = [
            "2025ÎÖÑ Ïõπ Í∞úÎ∞ú Ìä∏Î†åÎìú: ÎØ∏ÎûòÎ•º Ïù¥ÎÅÑÎäî Í∏∞Ïà†Îì§",
            "Í∞úÎ∞úÏûêÍ∞Ä ÏïåÏïÑÏïº Ìï† ÏµúÏã† React Ìå®ÌÑ¥Í≥º Î≤†Ïä§Ìä∏ ÌîÑÎûôÌã∞Ïä§",
            "Ìö®Ïú®Ï†ÅÏù∏ ÏΩîÎìú ÏûëÏÑ±ÏùÑ ÏúÑÌïú TypeScript ÌôúÏö©Î≤ï"
        ];

        const suggested = suggestions[Math.floor(Math.random() * suggestions.length)];
        form.setFieldValue('title', suggested);

        notifications.show({
            title: 'AI Ï†úÎ™© Ï†úÏïà',
            message: 'ÏÉàÎ°úÏö¥ Ï†úÎ™©Ïù¥ Ï†úÏïàÎêòÏóàÏäµÎãàÎã§!',
            color: 'blue'
        });
        setIsAILoading(false);
    };

    const handleAIOptimizeContent = async () => {
        setIsAILoading(true);
        await new Promise(resolve => setTimeout(resolve, 2000));

        notifications.show({
            title: 'AI ÎÇ¥Ïö© ÏµúÏ†ÅÌôî',
            message: 'ÎÇ¥Ïö©Ïù¥ SEOÏôÄ Í∞ÄÎèÖÏÑ±ÏùÑ ÏúÑÌï¥ ÏµúÏ†ÅÌôîÎêòÏóàÏäµÎãàÎã§!',
            color: 'green'
        });
        setIsAILoading(false);
    };

    // ÏΩîÎìú Î∏îÎ°ù ÏÇΩÏûÖ
    const handleInsertCodeBlock = (code, language) => {
        if (editor) {
            editor.chain().focus().setCodeBlock({ language }).insertContent(code).run();
        }
    };

    // Ï†ÄÏû• Î∞è Î∞úÌñâ
    const handleSave = async () => {
        if (form.validate().hasErrors) {
            notifications.show({
                title: 'ÏûÖÎ†• Ïò§Î•ò',
                message: 'ÌïÑÏàò ÌïÑÎìúÎ•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                color: 'red'
            });
            return;
        }

        setSaveProgress(0);

        // Ï†ÄÏû• ÏßÑÌñâÎ•† ÏãúÎÆ¨Î†àÏù¥ÏÖò
        const interval = setInterval(() => {
            setSaveProgress(prev => {
                if (prev >= 100) {
                    clearInterval(interval);
                    notifications.show({
                        title: isDraft ? 'ÏûÑÏãúÏ†ÄÏû• ÏôÑÎ£å' : 'Î∞úÌñâ ÏôÑÎ£å',
                        message: isDraft ? 'Ìè¨Ïä§Ìä∏Í∞Ä ÏûÑÏãúÏ†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.' : 'Ìè¨Ïä§Ìä∏Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∞úÌñâÎêòÏóàÏäµÎãàÎã§!',
                        color: isDraft ? 'orange' : 'green'
                    });
                    setTimeout(() => setSaveProgress(0), 2000);
                    return 100;
                }
                return prev + 10;
            });
        }, 100);
    };

    const handlePreview = () => {
        setPreviewModalOpened(true);
    };

    return (
        <Box style={{ minHeight: '100vh', backgroundColor: 'var(--mantine-color-body)' }}>
            <Container size="lg" py="xl">
                {/* Ìó§Îçî */}
                <Paper
                    p="xl"
                    mb="xl"
                    style={{
                        background: computedColorScheme === 'light'
                            ? 'linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9))'
                            : 'linear-gradient(135deg, rgba(30, 30, 30, 0.9), rgba(20, 20, 20, 0.9))',
                        backdropFilter: 'blur(20px)',
                        border: computedColorScheme === 'light'
                            ? '1px solid rgba(0, 0, 0, 0.08)'
                            : '1px solid rgba(255, 255, 255, 0.08)',
                        borderRadius: '24px',
                        boxShadow: computedColorScheme === 'light'
                            ? '0 20px 40px rgba(0, 0, 0, 0.1)'
                            : '0 20px 40px rgba(255, 255, 255, 0.02)'
                    }}
                >
                    <Group justify="space-between" align="center">
                        <Box>
                            <Title
                                order={1}
                                style={{
                                    background: 'linear-gradient(135deg, var(--mantine-color-blue-6), var(--mantine-color-violet-6))',
                                    WebkitBackgroundClip: 'text',
                                    WebkitTextFillColor: 'transparent',
                                    fontSize: 'clamp(1.5rem, 4vw, 2.5rem)'
                                }}
                            >
                                Ìè¨Ïä§Ìä∏ ÏûëÏÑ±
                            </Title>
                            <Text c="dimmed" mt="xs">
                                2025ÎÖÑ Ìä∏Î†åÎìúÎ•º Î∞òÏòÅÌïú ÌòÑÎåÄÏ†Å ÏóêÎîîÌÑ∞Î°ú Î©ãÏßÑ Í∏ÄÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî
                            </Text>
                        </Box>

                        <Group>
                            {/* Îã§ÌÅ¨Î™®Îìú ÌÜ†Í∏Ä - 2025 Ìä∏Î†åÎìú Î∞òÏòÅ */}
                            <Tooltip label={`${colorScheme === 'dark' ? 'ÎùºÏù¥Ìä∏' : 'Îã§ÌÅ¨'} Î™®Îìú`}>
                                <ActionIcon
                                    variant="light"
                                    size="lg"
                                    onClick={() => toggleColorScheme()}
                                    style={{
                                        background: colorScheme === 'dark'
                                            ? 'linear-gradient(135deg, var(--mantine-color-yellow-4), var(--mantine-color-orange-4))'
                                            : 'linear-gradient(135deg, var(--mantine-color-blue-6), var(--mantine-color-indigo-6))',
                                        color: 'white',
                                        transition: 'all 0.3s ease'
                                    }}
                                >
                                    {colorScheme === 'dark' ? <IconSun size={20} /> : <IconMoon size={20} />}
                                </ActionIcon>
                            </Tooltip>

                            <Switch
                                label="Î∞úÌñâÎ™®Îìú"
                                checked={!isDraft}
                                onChange={(event) => setIsDraft(!event.currentTarget.checked)}
                                color="green"
                                size="md"
                            />
                        </Group>
                    </Group>
                </Paper>

                <Grid>
                    <Grid.Col span={{ base: 12, md: 8 }}>
                        {/* Î©îÏù∏ ÏóêÎîîÌÑ∞ ÏòÅÏó≠ */}
                        <Stack gap="lg">
                            {/* Í∏∞Î≥∏ Ï†ïÎ≥¥ */}
                            <Paper
                                p="lg"
                                style={{
                                    background: computedColorScheme === 'light'
                                        ? 'rgba(255, 255, 255, 0.8)'
                                        : 'rgba(30, 30, 30, 0.8)',
                                    backdropFilter: 'blur(20px)',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(0, 0, 0, 0.05)'
                                        : '1px solid rgba(255, 255, 255, 0.05)',
                                    borderRadius: '16px'
                                }}
                            >
                                <Stack gap="md">
                                    <TextInput
                                        label="Ï†úÎ™©"
                                        placeholder="Ìè¨Ïä§Ìä∏ Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
                                        size="lg"
                                        {...form.getInputProps('title')}
                                        styles={{
                                            input: {
                                                fontSize: '1.25rem',
                                                fontWeight: 600
                                            }
                                        }}
                                    />

                                    <TextInput
                                        label="Î∂ÄÏ†úÎ™©"
                                        placeholder="Î∂ÄÏ†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏÑ†ÌÉùÏÇ¨Ìï≠)"
                                        {...form.getInputProps('subtitle')}
                                    />

                                    <Group grow>
                                        <Select
                                            label="Ïπ¥ÌÖåÍ≥†Î¶¨"
                                            placeholder="Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî"
                                            data={categories}
                                            {...form.getInputProps('category')}
                                        />

                                        <FileInput
                                            label="Î∞∞ÎÑà Ïù¥ÎØ∏ÏßÄ"
                                            placeholder="Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî"
                                            accept="image/*"
                                            leftSection={<IconPhoto size={16} />}
                                            {...form.getInputProps('bannerImage')}
                                        />
                                    </Group>
                                </Stack>
                            </Paper>

                            {/* Rich Text Editor */}
                            <Paper
                                style={{
                                    background: computedColorScheme === 'light'
                                        ? 'rgba(255, 255, 255, 0.8)'
                                        : 'rgba(30, 30, 30, 0.8)',
                                    backdropFilter: 'blur(20px)',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(0, 0, 0, 0.05)'
                                        : '1px solid rgba(255, 255, 255, 0.05)',
                                    borderRadius: '16px',
                                    overflow: 'hidden'
                                }}
                            >
                                <Box p="md" style={{ borderBottom: '1px solid var(--mantine-color-gray-3)' }}>
                                    <Group justify="space-between">
                                        <Text fw={600}>ÎÇ¥Ïö© ÏûëÏÑ±</Text>
                                        <Group gap="xs">
                                            <Tooltip label="ÏΩîÎìú Î∏îÎ°ù ÏÇΩÏûÖ">
                                                <ActionIcon
                                                    variant="light"
                                                    onClick={() => setCodeModalOpened(true)}
                                                >
                                                    <IconCode size={16} />
                                                </ActionIcon>
                                            </Tooltip>
                                        </Group>
                                    </Group>
                                </Box>

                                <RichTextEditor
                                    editor={editor}
                                    style={{
                                        border: 'none'
                                    }}
                                >
                                    <RichTextEditor.Toolbar sticky stickyOffset={60}>
                                        <RichTextEditor.ControlsGroup>
                                            <RichTextEditor.Bold />
                                            <RichTextEditor.Italic />
                                            <RichTextEditor.Underline />
                                            <RichTextEditor.Strikethrough />
                                            <RichTextEditor.ClearFormatting />
                                            <RichTextEditor.Highlight />
                                            <RichTextEditor.Code />
                                        </RichTextEditor.ControlsGroup>

                                        <RichTextEditor.ControlsGroup>
                                            <RichTextEditor.H1 />
                                            <RichTextEditor.H2 />
                                            <RichTextEditor.H3 />
                                            <RichTextEditor.H4 />
                                        </RichTextEditor.ControlsGroup>

                                        <RichTextEditor.ControlsGroup>
                                            <RichTextEditor.Blockquote />
                                            <RichTextEditor.Hr />
                                            <RichTextEditor.BulletList />
                                            <RichTextEditor.OrderedList />
                                            <RichTextEditor.Subscript />
                                            <RichTextEditor.Superscript />
                                        </RichTextEditor.ControlsGroup>

                                        <RichTextEditor.ControlsGroup>
                                            <RichTextEditor.Link />
                                            <RichTextEditor.Unlink />
                                        </RichTextEditor.ControlsGroup>

                                        <RichTextEditor.ControlsGroup>
                                            <RichTextEditor.AlignLeft />
                                            <RichTextEditor.AlignCenter />
                                            <RichTextEditor.AlignJustify />
                                            <RichTextEditor.AlignRight />
                                        </RichTextEditor.ControlsGroup>

                                        <RichTextEditor.ControlsGroup>
                                            <RichTextEditor.Undo />
                                            <RichTextEditor.Redo />
                                        </RichTextEditor.ControlsGroup>
                                    </RichTextEditor.Toolbar>

                                    <RichTextEditor.Content
                                        style={{
                                            minHeight: '400px',
                                            fontSize: '16px',
                                            lineHeight: 1.6
                                        }}
                                    />
                                </RichTextEditor>
                            </Paper>

                            {/* SEO ÏÑ§Ï†ï */}
                            <Paper
                                p="lg"
                                style={{
                                    background: computedColorScheme === 'light'
                                        ? 'rgba(255, 255, 255, 0.8)'
                                        : 'rgba(30, 30, 30, 0.8)',
                                    backdropFilter: 'blur(20px)',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(0, 0, 0, 0.05)'
                                        : '1px solid rgba(255, 255, 255, 0.05)',
                                    borderRadius: '16px'
                                }}
                            >
                                <Text fw={600} mb="md">SEO ÏÑ§Ï†ï</Text>
                                <Textarea
                                    label="Î©îÌÉÄ ÏÑ§Î™Ö"
                                    placeholder="Í≤ÄÏÉâ ÏóîÏßÑÏóê ÌëúÏãúÎê† ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (150Ïûê Ïù¥ÎÇ¥ Í∂åÏû•)"
                                    maxLength={160}
                                    {...form.getInputProps('metaDescription')}
                                />
                                <Text size="xs" c="dimmed" mt="xs">
                                    {form.values.metaDescription.length}/160 Î¨∏Ïûê
                                </Text>
                            </Paper>
                        </Stack>
                    </Grid.Col>

                    <Grid.Col span={{ base: 12, md: 4 }}>
                        {/* ÏÇ¨Ïù¥ÎìúÎ∞î */}
                        <Stack gap="lg">
                            {/* AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ - 2025 Ìä∏Î†åÎìú */}
                            <AIAssistant
                                onSuggestTags={handleAISuggestTags}
                                onSuggestTitle={handleAISuggestTitle}
                                onOptimizeContent={handleAIOptimizeContent}
                                isLoading={isAILoading}
                            />

                            {/* ÌÉúÍ∑∏ ÏÑ†ÌÉù */}
                            <Paper
                                p="lg"
                                style={{
                                    background: computedColorScheme === 'light'
                                        ? 'rgba(255, 255, 255, 0.8)'
                                        : 'rgba(30, 30, 30, 0.8)',
                                    backdropFilter: 'blur(20px)',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(0, 0, 0, 0.05)'
                                        : '1px solid rgba(255, 255, 255, 0.05)',
                                    borderRadius: '16px'
                                }}
                            >
                                <Text fw={600} mb="md">ÌÉúÍ∑∏</Text>
                                <MultiSelect
                                    placeholder="ÌÉúÍ∑∏Î•º ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉàÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                    data={suggestedTags}
                                    searchable
                                    creatable
                                    getCreateLabel={(query) => `+ "${query}" ÌÉúÍ∑∏ ÏÉùÏÑ±`}
                                    onCreate={(query) => {
                                        const item = { value: query, label: query };
                                        suggestedTags.push(query);
                                        return item;
                                    }}
                                    value={selectedTags}
                                    onChange={(value) => {
                                        setSelectedTags(value);
                                        form.setFieldValue('tags', value);
                                    }}
                                    leftSection={<IconTag size={16} />}
                                />

                                {selectedTags.length > 0 && (
                                    <Box mt="md">
                                        <Text size="sm" c="dimmed" mb="xs">ÏÑ†ÌÉùÎêú ÌÉúÍ∑∏:</Text>
                                        <Group gap="xs">
                                            {selectedTags.map((tag) => (
                                                <Badge
                                                    key={tag}
                                                    variant="light"
                                                    size="sm"
                                                    rightSection={
                                                        <ActionIcon
                                                            size="xs"
                                                            variant="transparent"
                                                            onClick={() => {
                                                                const newTags = selectedTags.filter(t => t !== tag);
                                                                setSelectedTags(newTags);
                                                                form.setFieldValue('tags', newTags);
                                                            }}
                                                        >
                                                            <IconX size={10} />
                                                        </ActionIcon>
                                                    }
                                                >
                                                    {tag}
                                                </Badge>
                                            ))}
                                        </Group>
                                    </Box>
                                )}
                            </Paper>

                            {/* Î∞úÌñâ ÏÑ§Ï†ï */}
                            <Paper
                                p="lg"
                                style={{
                                    background: computedColorScheme === 'light'
                                        ? 'rgba(255, 255, 255, 0.8)'
                                        : 'rgba(30, 30, 30, 0.8)',
                                    backdropFilter: 'blur(20px)',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(0, 0, 0, 0.05)'
                                        : '1px solid rgba(255, 255, 255, 0.05)',
                                    borderRadius: '16px'
                                }}
                            >
                                <Text fw={600} mb="md">Î∞úÌñâ ÏÑ§Ï†ï</Text>
                                <Stack gap="md">
                                    <Alert
                                        icon={isDraft ? <IconAlertCircle size={16} /> : <IconCheck size={16} />}
                                        color={isDraft ? "orange" : "green"}
                                        variant="light"
                                    >
                                        <Text size="sm">
                                            {isDraft
                                                ? "ÏûÑÏãúÏ†ÄÏû• Î™®Îìú: Ìè¨Ïä§Ìä∏Í∞Ä ÎπÑÍ≥µÍ∞úÎ°ú Ï†ÄÏû•Îê©ÎãàÎã§"
                                                : "Î∞úÌñâ Î™®Îìú: Ìè¨Ïä§Ìä∏Í∞Ä Í≥µÍ∞úÏ†ÅÏúºÎ°ú Î∞úÌñâÎê©ÎãàÎã§"
                                            }
                                        </Text>
                                    </Alert>

                                    <Group justify="space-between">
                                        <Text size="sm">ÎåìÍ∏Ä ÌóàÏö©</Text>
                                        <Switch defaultChecked size="sm" />
                                    </Group>

                                    <Group justify="space-between">
                                        <Text size="sm">Í≥µÏú† ÌóàÏö©</Text>
                                        <Switch defaultChecked size="sm" />
                                    </Group>
                                </Stack>
                            </Paper>

                            {/* ÌÜµÍ≥Ñ Î∞è Ï†ïÎ≥¥ */}
                            <Paper
                                p="lg"
                                style={{
                                    background: computedColorScheme === 'light'
                                        ? 'linear-gradient(135deg, rgba(34, 139, 230, 0.05), rgba(99, 102, 241, 0.05))'
                                        : 'linear-gradient(135deg, rgba(34, 139, 230, 0.1), rgba(99, 102, 241, 0.1))',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(34, 139, 230, 0.2)'
                                        : '1px solid rgba(99, 102, 241, 0.2)',
                                    borderRadius: '16px'
                                }}
                            >
                                <Text fw={600} mb="md">ÏûëÏÑ± Ï†ïÎ≥¥</Text>
                                <Stack gap="xs">
                                    <Group justify="space-between">
                                        <Text size="sm" c="dimmed">Í∏ÄÏûê Ïàò</Text>
                                        <Text size="sm" fw={500}>
                                            {form.values.content.replace(/<[^>]*>/g, '').length}Ïûê
                                        </Text>
                                    </Group>
                                    <Group justify="space-between">
                                        <Text size="sm" c="dimmed">ÏòàÏÉÅ ÏùΩÍ∏∞ ÏãúÍ∞Ñ</Text>
                                        <Text size="sm" fw={500}>
                                            {Math.max(1, Math.ceil(form.values.content.replace(/<[^>]*>/g, '').length / 300))}Î∂Ñ
                                        </Text>
                                    </Group>
                                    <Group justify="space-between">
                                        <Text size="sm" c="dimmed">ÌÉúÍ∑∏ Ïàò</Text>
                                        <Text size="sm" fw={500}>
                                            {selectedTags.length}Í∞ú
                                        </Text>
                                    </Group>
                                </Stack>
                            </Paper>
                        </Stack>
                    </Grid.Col>
                </Grid>
            </Container>

            {/* ÌîåÎ°úÌåÖ Ìà¥Î∞î - 2025 Ìä∏Î†åÎìú Î∞òÏòÅ */}
            <FloatingToolbar
                onSave={handleSave}
                onPreview={handlePreview}
                isDraft={isDraft}
                saveProgress={saveProgress}
            />

            {/* ÏΩîÎìú Î∏îÎ°ù ÏÇΩÏûÖ Î™®Îã¨ */}
            <CodeBlockModal
                opened={codeModalOpened}
                onClose={() => setCodeModalOpened(false)}
                onInsert={handleInsertCodeBlock}
            />

            {/* ÎØ∏Î¶¨Î≥¥Í∏∞ Î™®Îã¨ */}
            <Modal
                opened={previewModalOpened}
                onClose={() => setPreviewModalOpened(false)}
                title="Ìè¨Ïä§Ìä∏ ÎØ∏Î¶¨Î≥¥Í∏∞"
                size="xl"
                style={{
                    backdropFilter: 'blur(10px)'
                }}
            >
                <Stack gap="md">
                    {form.values.bannerImage && (
                        <Image
                            src={URL.createObjectURL(form.values.bannerImage)}
                            alt="Î∞∞ÎÑà Ïù¥ÎØ∏ÏßÄ"
                            radius="md"
                            h={200}
                            fit="cover"
                        />
                    )}

                    <Box>
                        <Badge color="blue" mb="sm">
                            {categories.find(cat => cat.value === form.values.category)?.label || 'Ïπ¥ÌÖåÍ≥†Î¶¨'}
                        </Badge>
                        <Title order={1} mb="xs">{form.values.title || 'Ï†úÎ™©'}</Title>
                        {form.values.subtitle && (
                            <Text size="lg" c="dimmed" mb="md">{form.values.subtitle}</Text>
                        )}
                    </Box>

                    <Box
                        style={{
                            border: '1px solid var(--mantine-color-gray-3)',
                            borderRadius: '8px',
                            padding: '16px',
                            maxHeight: '400px',
                            overflow: 'auto'
                        }}
                        dangerouslySetInnerHTML={{
                            __html: form.values.content || '<p>ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî...</p>'
                        }}
                    />

                    {selectedTags.length > 0 && (
                        <Box>
                            <Text size="sm" fw={500} mb="xs">ÌÉúÍ∑∏:</Text>
                            <Group gap="xs">
                                {selectedTags.map((tag) => (
                                    <Badge key={tag} variant="light" size="sm">
                                        #{tag}
                                    </Badge>
                                ))}
                            </Group>
                        </Box>
                    )}
                </Stack>
            </Modal>
        </Box>
    );
}