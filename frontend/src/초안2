import React, { useState, useEffect } from 'react';
import {
    Container,
    Text,
    Stack,
    Group,
    Avatar,
    Badge,
    ActionIcon,
    Divider,
    Box,
    Paper,
    Affix,
    Transition,
    Progress,
    Tooltip,
    Button,
    useMantineColorScheme,
    useComputedColorScheme,
    Card,
    Textarea,
    Modal
} from '@mantine/core';
import {
    IconHeart,
    IconBookmark,
    IconShare2,
    IconMessageCircle,
    IconEye,
    IconCalendar,
    IconClock,
    IconArrowLeft,
    IconArrowUp,
    IconSun,
    IconMoon,
    IconBrandTwitter,
    IconBrandFacebook,
    IconBrandLinkedin,
    IconCopy,
    IconPhoto,
    IconSend,
    IconDots
} from '@tabler/icons-react';

// ë‹¤í¬ ëª¨ë“œ í† ê¸€ ì»´í¬ë„ŒíŠ¸
function DarkModeToggle() {
    const { setColorScheme } = useMantineColorScheme();
    const computedColorScheme = useComputedColorScheme('light', { getInitialValueInEffect: true });
    const [isHovered, setIsHovered] = useState(false);

    const toggleColorScheme = () => {
        setColorScheme(computedColorScheme === 'light' ? 'dark' : 'light');
    };

    return (
        <Tooltip
            label={computedColorScheme === 'light' ? 'ë‹¤í¬ ëª¨ë“œë¡œ ì „í™˜' : 'ë¼ì´íŠ¸ ëª¨ë“œë¡œ ì „í™˜'}
            position="left"
        >
            <ActionIcon
                onClick={toggleColorScheme}
                variant="gradient"
                gradient={
                    computedColorScheme === 'light'
                        ? { from: 'indigo', to: 'purple', deg: 135 }
                        : { from: 'yellow', to: 'orange', deg: 135 }
                }
                size="lg"
                style={{
                    border: `2px solid ${computedColorScheme === 'light' ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.2)'}`,
                    backdropFilter: 'blur(20px)',
                    boxShadow: computedColorScheme === 'light'
                        ? '0 8px 32px rgba(0, 0, 0, 0.15)'
                        : '0 8px 32px rgba(255, 255, 255, 0.1)',
                    transform: isHovered ? 'scale(1.1) rotate(180deg)' : 'scale(1) rotate(0deg)',
                    transition: 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
                }}
                onMouseEnter={() => setIsHovered(true)}
                onMouseLeave={() => setIsHovered(false)}
            >
                {computedColorScheme === 'light' ? <IconMoon size={18} /> : <IconSun size={18} />}
            </ActionIcon>
        </Tooltip>
    );
}

// í¬ìŠ¤íŠ¸ ë„¤ë¹„ê²Œì´í„° ì»´í¬ë„ŒíŠ¸
function PostNavigator({ currentProgress, onScrollTo }) {
    const computedColorScheme = useComputedColorScheme('light');
    const [activeSection, setActiveSection] = useState(0);

    const sections = [
        { id: 'intro', title: 'ì†Œê°œ', progress: 0 },
        { id: 'overview', title: 'ê°œìš”', progress: 20 },
        { id: 'content', title: 'ë³¸ë¬¸', progress: 40 },
        { id: 'examples', title: 'ì˜ˆì‹œ', progress: 60 },
        { id: 'conclusion', title: 'ê²°ë¡ ', progress: 80 },
        { id: 'comments', title: 'ëŒ“ê¸€', progress: 100 }
    ];

    useEffect(() => {
        const currentSection = sections.findIndex(section =>
            currentProgress >= section.progress &&
            currentProgress < (sections[sections.indexOf(section) + 1]?.progress || 100)
        );
        setActiveSection(Math.max(0, currentSection));
    }, [currentProgress]);

    return (
        <Affix position={{ top: '50%', right: 20 }} style={{ transform: 'translateY(-50%)' }}>
            <Paper
                p="md"
                style={{
                    background: computedColorScheme === 'light'
                        ? 'rgba(255, 255, 255, 0.95)'
                        : 'rgba(20, 20, 20, 0.95)',
                    backdropFilter: 'blur(20px)',
                    border: computedColorScheme === 'light'
                        ? '1px solid rgba(0, 0, 0, 0.1)'
                        : '1px solid rgba(255, 255, 255, 0.1)',
                    borderRadius: '20px',
                    boxShadow: computedColorScheme === 'light'
                        ? '0 12px 40px rgba(0, 0, 0, 0.15)'
                        : '0 12px 40px rgba(255, 255, 255, 0.05)',
                    width: '220px'
                }}
            >
                <Stack gap="sm">
                    <Group justify="space-between" align="center" mb="xs">
                        <Text size="sm" fw={700}
                              style={{
                                  background: 'linear-gradient(135deg, var(--mantine-color-blue-6), var(--mantine-color-violet-6))',
                                  backgroundClip: 'text',
                                  WebkitBackgroundClip: 'text',
                                  color: 'transparent'
                              }}
                        >
                            ëª©ì°¨
                        </Text>
                        <DarkModeToggle />
                    </Group>

                    <Progress
                        value={currentProgress}
                        size="sm"
                        radius="xl"
                        style={{ marginBottom: '12px' }}
                        color="violet"
                    />

                    {sections.map((section, index) => (
                        <Box
                            key={section.id}
                            style={{
                                padding: '12px 16px',
                                borderRadius: '12px',
                                cursor: 'pointer',
                                background: activeSection === index
                                    ? computedColorScheme === 'light'
                                        ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 69, 19, 0.1))'
                                        : 'linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 69, 19, 0.2))'
                                    : 'transparent',
                                border: activeSection === index
                                    ? '1px solid rgba(99, 102, 241, 0.3)'
                                    : '1px solid transparent',
                                transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                                transform: activeSection === index ? 'scale(1.02)' : 'scale(1)'
                            }}
                            onClick={() => onScrollTo(section.progress)}
                        >
                            <Text
                                size="sm"
                                c={activeSection === index ? 'violet' : 'dimmed'}
                                fw={activeSection === index ? 600 : 400}
                                style={{ transition: 'all 0.2s ease' }}
                            >
                                {section.title}
                            </Text>
                        </Box>
                    ))}
                </Stack>
            </Paper>
        </Affix>
    );
}

// í”Œë¡œíŒ… ì•¡ì…˜ ë²„íŠ¼
function FloatingActions() {
    const [isLiked, setIsLiked] = useState(false);
    const [isBookmarked, setIsBookmarked] = useState(false);
    const [showScrollTop, setShowScrollTop] = useState(false);
    const [shareModal, setShareModal] = useState(false);
    const computedColorScheme = useComputedColorScheme('light');

    useEffect(() => {
        const handleScroll = () => {
            setShowScrollTop(window.scrollY > 300);
        };
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
    }, []);

    const scrollToTop = () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    const shareActions = [
        { icon: IconBrandTwitter, label: 'Twitter', color: '#1DA1F2' },
        { icon: IconBrandFacebook, label: 'Facebook', color: '#4267B2' },
        { icon: IconBrandLinkedin, label: 'LinkedIn', color: '#0077B5' },
        { icon: IconCopy, label: 'ë§í¬ ë³µì‚¬', color: '#666' }
    ];

    const handleShare = (label) => {
        if (label === 'ë§í¬ ë³µì‚¬') {
            navigator.clipboard.writeText(window.location.href);
        }
        setShareModal(false);
    };

    return (
        <>
            <Affix position={{ bottom: 30, left: 30 }}>
                <Stack gap="sm">
                    <Paper
                        p="sm"
                        style={{
                            background: computedColorScheme === 'light'
                                ? 'rgba(255, 255, 255, 0.95)'
                                : 'rgba(20, 20, 20, 0.95)',
                            backdropFilter: 'blur(20px)',
                            border: computedColorScheme === 'light'
                                ? '1px solid rgba(0, 0, 0, 0.1)'
                                : '1px solid rgba(255, 255, 255, 0.1)',
                            borderRadius: '20px',
                            boxShadow: computedColorScheme === 'light'
                                ? '0 12px 40px rgba(0, 0, 0, 0.15)'
                                : '0 12px 40px rgba(255, 255, 255, 0.05)'
                        }}
                    >
                        <Stack gap="xs">
                            <Tooltip label="ê³µìœ í•˜ê¸°" position="right">
                                <ActionIcon
                                    variant="gradient"
                                    gradient={{ from: 'blue', to: 'cyan' }}
                                    size="lg"
                                    onClick={() => setShareModal(true)}
                                    style={{
                                        transition: 'all 0.3s ease'
                                    }}
                                >
                                    <IconShare2 size={20} />
                                </ActionIcon>
                            </Tooltip>

                            <Divider size="xs" />

                            <Tooltip label={isLiked ? 'ì¢‹ì•„ìš” ì·¨ì†Œ' : 'ì¢‹ì•„ìš”'} position="right">
                                <ActionIcon
                                    variant={isLiked ? "filled" : "gradient"}
                                    color={isLiked ? "red" : undefined}
                                    gradient={!isLiked ? { from: 'pink', to: 'red' } : undefined}
                                    size="lg"
                                    onClick={() => setIsLiked(!isLiked)}
                                    style={{
                                        transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                                        transform: isLiked ? 'scale(1.15)' : 'scale(1)'
                                    }}
                                >
                                    <IconHeart size={20} fill={isLiked ? "currentColor" : "none"} />
                                </ActionIcon>
                            </Tooltip>

                            <Tooltip label={isBookmarked ? 'ë¶ë§ˆí¬ í•´ì œ' : 'ë¶ë§ˆí¬'} position="right">
                                <ActionIcon
                                    variant={isBookmarked ? "filled" : "gradient"}
                                    color={isBookmarked ? "yellow" : undefined}
                                    gradient={!isBookmarked ? { from: 'yellow', to: 'orange' } : undefined}
                                    size="lg"
                                    onClick={() => setIsBookmarked(!isBookmarked)}
                                    style={{
                                        transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                                        transform: isBookmarked ? 'scale(1.15)' : 'scale(1)'
                                    }}
                                >
                                    <IconBookmark size={20} fill={isBookmarked ? "currentColor" : "none"} />
                                </ActionIcon>
                            </Tooltip>
                        </Stack>
                    </Paper>

                    <Transition mounted={showScrollTop} transition="slide-up" duration={300}>
                        {(styles) => (
                            <ActionIcon
                                style={{
                                    ...styles,
                                    background: 'linear-gradient(135deg, var(--mantine-color-violet-6), var(--mantine-color-blue-6))',
                                    backdropFilter: 'blur(20px)',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(0, 0, 0, 0.1)'
                                        : '1px solid rgba(255, 255, 255, 0.1)',
                                    borderRadius: '50%',
                                    boxShadow: computedColorScheme === 'light'
                                        ? '0 12px 40px rgba(0, 0, 0, 0.15)'
                                        : '0 12px 40px rgba(255, 255, 255, 0.05)',
                                    transition: 'all 0.3s ease'
                                }}
                                size="xl"
                                onClick={scrollToTop}
                            >
                                <IconArrowUp size={24} color="white" />
                            </ActionIcon>
                        )}
                    </Transition>
                </Stack>
            </Affix>

            <Modal
                opened={shareModal}
                onClose={() => setShareModal(false)}
                title="í¬ìŠ¤íŠ¸ ê³µìœ í•˜ê¸°"
                centered
                radius="lg"
            >
                <Stack gap="md">
                    {shareActions.map(({ icon: Icon, label, color }) => (
                        <Button
                            key={label}
                            variant="light"
                            leftSection={<Icon size={20} />}
                            onClick={() => handleShare(label)}
                            style={{
                                '--button-color': color,
                                transition: 'all 0.2s ease'
                            }}
                        >
                            {label}
                        </Button>
                    ))}
                </Stack>
            </Modal>
        </>
    );
}

// ëŒ“ê¸€ ì…ë ¥ í¼
function CommentForm({ onSubmit }) {
    const [comment, setComment] = useState('');
    const [isSubmitting, setIsSubmitting] = useState(false);
    const computedColorScheme = useComputedColorScheme('light');

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (!comment.trim()) {
            return false;
        }

        setIsSubmitting(true);
        await new Promise(resolve => setTimeout(resolve, 1000));
        onSubmit(comment);
        setComment('');
        setIsSubmitting(false);
    };

    return (
        <Paper
            p="lg"
            mb="xl"
            style={{
                background: computedColorScheme === 'light'
                    ? 'rgba(255, 255, 255, 0.95)'
                    : 'rgba(30, 30, 30, 0.95)',
                backdropFilter: 'blur(20px)',
                border: computedColorScheme === 'light'
                    ? '1px solid rgba(0, 0, 0, 0.1)'
                    : '1px solid rgba(255, 255, 255, 0.1)',
                borderRadius: '20px',
                boxShadow: computedColorScheme === 'light'
                    ? '0 8px 32px rgba(0, 0, 0, 0.08)'
                    : '0 8px 32px rgba(255, 255, 255, 0.02)'
            }}
        >
            <form onSubmit={handleSubmit}>
                <Group align="flex-start" gap="md">
                    <Avatar
                        src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=50&h=50&fit=crop&crop=face"
                        size="lg"
                        style={{
                            border: '3px solid rgba(99, 102, 241, 0.3)',
                            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.1)'
                        }}
                    />
                    <Stack gap="md" style={{ flex: 1 }}>
                        <Textarea
                            placeholder="ì´ í¬ìŠ¤íŠ¸ì— ëŒ€í•œ ìƒê°ì„ ê³µìœ í•´ë³´ì„¸ìš”..."
                            value={comment}
                            onChange={(e) => setComment(e.target.value)}
                            minRows={3}
                            maxRows={6}
                            autosize
                            style={{
                                '& .mantine-Textarea-input': {
                                    background: computedColorScheme === 'light'
                                        ? 'rgba(249, 250, 251, 0.8)'
                                        : 'rgba(40, 40, 40, 0.8)',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(0, 0, 0, 0.1)'
                                        : '1px solid rgba(255, 255, 255, 0.1)',
                                    borderRadius: '12px',
                                    fontSize: '14px',
                                    lineHeight: 1.6
                                }
                            }}
                        />
                        <Group justify="space-between" align="center">
                            <Group gap="xs">
                                <ActionIcon variant="subtle" size="sm">
                                    <IconPhoto size={18} />
                                </ActionIcon>
                                <Text size="xs" c="dimmed">ì´ë¯¸ì§€ ì²¨ë¶€</Text>
                            </Group>
                            <Button
                                type="submit"
                                variant="gradient"
                                gradient={{ from: 'violet', to: 'blue' }}
                                leftSection={<IconSend size={18} />}
                                disabled={!comment.trim()}
                                loading={isSubmitting}
                                style={{
                                    transition: 'all 0.2s ease',
                                    opacity: comment.trim() ? 1 : 0.6
                                }}
                            >
                                ëŒ“ê¸€ ì‘ì„±
                            </Button>
                        </Group>
                    </Stack>
                </Group>
            </form>
        </Paper>
    );
}

// ëŒ“ê¸€ ì»´í¬ë„ŒíŠ¸
function Comment({ comment, onReply, isReply = false }) {
    const [showReplyForm, setShowReplyForm] = useState(false);
    const [isLiked, setIsLiked] = useState(false);
    const computedColorScheme = useComputedColorScheme('light');

    const handleReply = (replyText) => {
        onReply(comment.id, replyText);
        setShowReplyForm(false);
    };

    return (
        <Paper
            p="lg"
            style={{
                background: computedColorScheme === 'light'
                    ? 'rgba(255, 255, 255, 0.95)'
                    : 'rgba(30, 30, 30, 0.95)',
                backdropFilter: 'blur(20px)',
                border: computedColorScheme === 'light'
                    ? '1px solid rgba(0, 0, 0, 0.05)'
                    : '1px solid rgba(255, 255, 255, 0.05)',
                borderRadius: '16px',
                marginLeft: isReply ? '40px' : '0',
                transition: 'all 0.2s ease'
            }}
        >
            <Group align="flex-start" gap="md">
                <Avatar
                    src={comment.author.avatar}
                    size={isReply ? "md" : "lg"}
                    style={{
                        border: `2px solid ${comment.author.verified ? 'var(--mantine-color-blue-6)' : 'rgba(255, 255, 255, 0.2)'}`,
                        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)'
                    }}
                />
                <Stack gap="xs" style={{ flex: 1 }}>
                    <Group justify="space-between" align="center">
                        <Group gap="xs">
                            <Text size="sm" fw={600}>{comment.author.name}</Text>
                            {comment.author.badge && (
                                <Badge variant="light" size="xs" color={comment.author.badgeColor}>
                                    {comment.author.badge}
                                </Badge>
                            )}
                            {comment.author.verified && (
                                <Badge variant="filled" size="xs" color="blue">âœ“</Badge>
                            )}
                        </Group>
                        <Group gap="xs">
                            <Text size="xs" c="dimmed">{comment.timestamp}</Text>
                            <ActionIcon variant="subtle" size="sm">
                                <IconDots size={16} />
                            </ActionIcon>
                        </Group>
                    </Group>

                    <Text size="sm" style={{ lineHeight: 1.6 }}>
                        {comment.content}
                    </Text>

                    <Group gap="lg" mt="xs">
                        <Group gap={4} style={{ cursor: 'pointer' }} onClick={() => setIsLiked(!isLiked)}>
                            <IconHeart size={16} color={isLiked ? "#e91e63" : undefined} fill={isLiked ? "currentColor" : "none"} />
                            <Text size="xs" c="dimmed">{comment.likes + (isLiked ? 1 : 0)}</Text>
                        </Group>
                        {!isReply && (
                            <Group gap={4} style={{ cursor: 'pointer' }} onClick={() => setShowReplyForm(!showReplyForm)}>
                                <IconMessageCircle size={16} />
                                <Text size="xs" c="dimmed">ë‹µê¸€</Text>
                            </Group>
                        )}
                        <Group gap={4} style={{ cursor: 'pointer' }}>
                            <IconShare2 size={16} />
                            <Text size="xs" c="dimmed">ê³µìœ </Text>
                        </Group>
                    </Group>

                    {showReplyForm && (
                        <Box mt="md" p="md" style={{
                            background: computedColorScheme === 'light'
                                ? 'rgba(249, 250, 251, 0.5)'
                                : 'rgba(40, 40, 40, 0.5)',
                            borderRadius: '12px',
                            border: computedColorScheme === 'light'
                                ? '1px solid rgba(0, 0, 0, 0.05)'
                                : '1px solid rgba(255, 255, 255, 0.05)'
                        }}>
                            <CommentForm onSubmit={handleReply} />
                        </Box>
                    )}

                    {comment.replies && comment.replies.length > 0 && (
                        <Stack gap="md" mt="md" pl="md" style={{
                            borderLeft: computedColorScheme === 'light'
                                ? '2px solid rgba(0, 0, 0, 0.1)'
                                : '2px solid rgba(255, 255, 255, 0.1)'
                        }}>
                            {comment.replies.map((reply) => (
                                <Comment key={reply.id} comment={reply} onReply={onReply} isReply={true} />
                            ))}
                        </Stack>
                    )}
                </Stack>
            </Group>
        </Paper>
    );
}

// ë©”ì¸ í¬ìŠ¤íŠ¸ ìƒì„¸ ì»´í¬ë„ŒíŠ¸
export default function CompletePostDetail() {
    const [scrollProgress, setScrollProgress] = useState(0);
    const [comments, setComments] = useState([
        {
            id: 1,
            author: {
                name: "ì´ê°œë°œì",
                avatar: "https://images.unsplash.com/photo-1494790108755-2616b612b786?w=40&h=40&fit=crop&crop=face",
                badge: "í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì",
                badgeColor: "blue",
                verified: true
            },
            content: "ì •ë§ ì¸ì‚¬ì´íŠ¸ê°€ ê°€ë“í•œ í¬ìŠ¤íŠ¸ë„¤ìš”! íŠ¹íˆ 2025ë…„ ì›¹ ë””ìì¸ íŠ¸ë Œë“œ ì¤‘ì—ì„œ ì‹¤í—˜ì  ë‚´ë¹„ê²Œì´ì…˜ ë¶€ë¶„ì´ ê°€ì¥ í¥ë¯¸ë¡œì› ìŠµë‹ˆë‹¤. ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë³¼ ë§Œí•œ ì•„ì´ë””ì–´ë“¤ì´ ë§ì•„ì„œ ë„ì›€ì´ ë˜ì—ˆì–´ìš”. ğŸ‘",
            timestamp: "2ì‹œê°„ ì „",
            likes: 12,
            replies: [
                {
                    id: 11,
                    author: {
                        name: "ê¹€ë””ìì´ë„ˆ",
                        avatar: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=32&h=32&fit=crop&crop=face",
                        badge: "ì‘ì„±ì",
                        badgeColor: "violet",
                        verified: true
                    },
                    content: "@ì´ê°œë°œì ê°ì‚¬í•©ë‹ˆë‹¤! ì‹¤í—˜ì  ë‚´ë¹„ê²Œì´ì…˜ì€ ì •ë§ 2025ë…„ì˜ í•µì‹¬ íŠ¸ë Œë“œ ì¤‘ í•˜ë‚˜ë¼ê³  ìƒê°í•´ìš”. ë‹¤ë§Œ ì‚¬ìš©ì ê²½í—˜ì„ í•´ì¹˜ì§€ ì•ŠëŠ” ì„ ì—ì„œ ì ìš©í•˜ëŠ” ê²Œ ì¤‘ìš”í•˜ê² ì£ . ğŸ¨",
                    timestamp: "1ì‹œê°„ ì „",
                    likes: 8
                }
            ]
        },
        {
            id: 2,
            author: {
                name: "ë°•UX",
                avatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=40&h=40&fit=crop&crop=face",
                badge: "UX ë””ìì´ë„ˆ",
                badgeColor: "green",
                verified: false
            },
            content: "ì§€ì†ê°€ëŠ¥í•œ ì›¹ ë””ìì¸ íŠ¸ë Œë“œê°€ íŠ¹íˆ ì¸ìƒì ì´ì—ˆì–´ìš”. í™˜ê²½ì„ ê³ ë ¤í•œ ë””ìì¸ì´ ë‹¨ìˆœíˆ íŠ¸ë Œë“œë¥¼ ë„˜ì–´ í•„ìˆ˜ê°€ ë˜ì–´ê°€ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì„±ëŠ¥ ìµœì í™”ì™€ í™˜ê²½ ë³´í˜¸ë¥¼ ë™ì‹œì— ë‹¬ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ë§¤ë ¥ì ì´ë„¤ìš”! ğŸŒ±",
            timestamp: "3ì‹œê°„ ì „",
            likes: 15,
            replies: []
        },
        {
            id: 3,
            author: {
                name: "ì •í’€ìŠ¤íƒ",
                avatar: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=40&h=40&fit=crop&crop=face",
                badge: "í’€ìŠ¤íƒ ê°œë°œì",
                badgeColor: "orange",
                verified: true
            },
            content: "ë§ˆì´í¬ë¡œ ì• ë‹ˆë©”ì´ì…˜ ë¶€ë¶„ì´ ì •ë§ ìœ ìš©í–ˆì–´ìš”! ìš”ì¦˜ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ì ê²½í—˜ì„ ìœ„í•´ ì• ë‹ˆë©”ì´ì…˜ì„ ë§ì´ ë„ì…í•˜ê³  ìˆëŠ”ë°, ê³¼ë„í•˜ì§€ ì•Šìœ¼ë©´ì„œë„ ì˜ë¯¸ìˆëŠ” ì• ë‹ˆë©”ì´ì…˜ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ê³ ë¯¼ì´ ë§ì•˜ê±°ë“ ìš”. ğŸš€",
            timestamp: "4ì‹œê°„ ì „",
            likes: 9,
            replies: []
        }
    ]);

    const computedColorScheme = useComputedColorScheme('light');

    useEffect(() => {
        const handleScroll = () => {
            const scrollTop = window.scrollY;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            const progress = Math.min((scrollTop / docHeight) * 100, 100);
            setScrollProgress(progress);
        };

        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
    }, []);

    const handleScrollTo = (targetProgress) => {
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const targetPosition = (targetProgress / 100) * docHeight;
        window.scrollTo({ top: targetPosition, behavior: 'smooth' });
    };

    const handleCommentSubmit = (commentText) => {
        const newComment = {
            id: Date.now(),
            author: {
                name: "í˜„ì¬ì‚¬ìš©ì",
                avatar: "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=40&h=40&fit=crop&crop=face",
                badge: "ìƒˆë¡œìš´ ë©¤ë²„",
                badgeColor: "cyan",
                verified: false
            },
            content: commentText,
            timestamp: "ë°©ê¸ˆ ì „",
            likes: 0,
            replies: []
        };
        setComments([newComment, ...comments]);
    };

    const handleReply = (parentId, replyText) => {
        setComments(comments.map(comment => {
            if (comment.id === parentId) {
                const newReply = {
                    id: Date.now(),
                    author: {
                        name: "í˜„ì¬ì‚¬ìš©ì",
                        avatar: "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=32&h=32&fit=crop&crop=face",
                        badge: "ìƒˆë¡œìš´ ë©¤ë²„",
                        badgeColor: "cyan",
                        verified: false
                    },
                    content: replyText,
                    timestamp: "ë°©ê¸ˆ ì „",
                    likes: 0
                };
                return {
                    ...comment,
                    replies: [...(comment.replies || []), newReply]
                };
            }
            return comment;
        }));
    };

    const post = {
        title: "2025ë…„ ì›¹ ë””ìì¸ íŠ¸ë Œë“œ: ë¯¸ë˜ë¥¼ ì´ë„ëŠ” í˜ì‹ ì ì¸ ë””ìì¸ íŒ¨ëŸ¬ë‹¤ì„",
        subtitle: "AI ê¸°ë°˜ ê°œì¸í™”, ì§€ì†ê°€ëŠ¥í•œ ë””ìì¸, ê·¸ë¦¬ê³  ëª°ì…í˜• ì‚¬ìš©ì ê²½í—˜ì˜ ì‹œëŒ€",
        bannerImage: "https://images.unsplash.com/photo-1558655146-9f40138edfeb?w=1200&h=600&fit=crop",
        author: {
            name: "ê¹€ë””ìì´ë„ˆ",
            avatar: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face",
            bio: "UX/UI ë””ìì´ë„ˆì´ì ì›¹ íŠ¸ë Œë“œ ì „ë¬¸ê°€",
            followers: "12.5K"
        },
        publishedAt: "2025-06-25",
        readTime: "12ë¶„",
        views: 3420,
        likes: 234,
        category: "ë””ìì¸",
        tags: ["ì›¹ë””ìì¸", "2025íŠ¸ë Œë“œ", "UI/UX", "ì‚¬ìš©ìê²½í—˜"]
    };

    return (
        <Box style={{ minHeight: '100vh' }}>
            {/* ì§„í–‰ë¥  í‘œì‹œë°” */}
            <Progress
                value={scrollProgress}
                size="xs"
                style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    zIndex: 1000
                }}
                color="violet"
            />

            {/* ë°°ë„ˆ ì´ë¯¸ì§€ ì„¹ì…˜ */}
            <Box
                style={{
                    height: '75vh',
                    backgroundImage: `linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 69, 19, 0.1)), url(${post.bannerImage})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center',
                    backgroundAttachment: 'fixed',
                    position: 'relative',
                    display: 'flex',
                    alignItems: 'end',
                    padding: '0 20px 80px'
                }}
            >
                {/* ê·¸ë¼ë””ì–¸íŠ¸ ì˜¤ë²„ë ˆì´ */}
                <Box
                    style={{
                        position: 'absolute',
                        top: 0,
                        left: 0,
                        right: 0,
                        bottom: 0,
                        background: computedColorScheme === 'light'
                            ? 'linear-gradient(180deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0.8) 100%)'
                            : 'linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.6) 50%, rgba(0,0,0,0.9) 100%)',
                        backdropFilter: 'blur(2px)'
                    }}
                />

                {/* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */}
                <ActionIcon
                    variant="filled"
                    size="xl"
                    style={{
                        position: 'absolute',
                        top: '30px',
                        left: '30px',
                        background: 'rgba(0, 0, 0, 0.6)',
                        backdropFilter: 'blur(20px)',
                        border: '1px solid rgba(255, 255, 255, 0.2)',
                        borderRadius: '50%',
                        transition: 'all 0.3s ease'
                    }}
                >
                    <IconArrowLeft size={24} color="white" />
                </ActionIcon>

                {/* íƒ€ì´í‹€ ì˜ì—­ */}
                <Container size="lg" style={{ position: 'relative', zIndex: 2, width: '100%' }}>
                    <Stack gap="lg">
                        <Badge
                            color="violet"
                            variant="gradient"
                            gradient={{ from: 'violet', to: 'blue', deg: 135 }}
                            size="xl"
                            style={{
                                backdropFilter: 'blur(20px)',
                                border: '1px solid rgba(255, 255, 255, 0.2)',
                                padding: '8px 20px',
                                fontSize: '16px',
                                fontWeight: 600
                            }}
                        >
                            {post.category}
                        </Badge>

                        <Text
                            size="4rem"
                            fw={900}
                            c="white"
                            style={{
                                fontSize: 'clamp(1.8rem, 5vw, 4rem)',
                                lineHeight: 1.1,
                                textShadow: '0 8px 32px rgba(0, 0, 0, 0.6)',
                                maxWidth: '85%',
                                background: 'linear-gradient(135deg, #ffffff, #e0e7ff)',
                                backgroundClip: 'text',
                                WebkitBackgroundClip: 'text',
                                color: 'transparent'
                            }}
                        >
                            {post.title}
                        </Text>

                        <Text
                            size="xl"
                            style={{
                                fontSize: 'clamp(1.1rem, 2.5vw, 1.5rem)',
                                color: 'rgba(255, 255, 255, 0.9)',
                                textShadow: '0 4px 16px rgba(0, 0, 0, 0.5)',
                                maxWidth: '75%',
                                lineHeight: 1.4
                            }}
                        >
                            {post.subtitle}
                        </Text>
                    </Stack>
                </Container>
            </Box>

            {/* ë©”ì¸ ì½˜í…ì¸  */}
            <Container size="md" py="xl">
                {/* ì‘ì„±ì ì •ë³´ */}
                <Card
                    p="xl"
                    mb="xl"
                    style={{
                        background: computedColorScheme === 'light'
                            ? 'rgba(255, 255, 255, 0.95)'
                            : 'rgba(30, 30, 30, 0.95)',
                        backdropFilter: 'blur(20px)',
                        border: computedColorScheme === 'light'
                            ? '1px solid rgba(0, 0, 0, 0.1)'
                            : '1px solid rgba(255, 255, 255, 0.1)',
                        borderRadius: '20px',
                        boxShadow: computedColorScheme === 'light'
                            ? '0 12px 40px rgba(0, 0, 0, 0.1)'
                            : '0 12px 40px rgba(255, 255, 255, 0.02)'
                    }}
                >
                    <Group justify="space-between" align="center">
                        <Group>
                            <Avatar
                                src={post.author.avatar}
                                size="xl"
                                style={{
                                    border: '3px solid var(--mantine-color-violet-6)',
                                    boxShadow: '0 4px 16px rgba(99, 102, 241, 0.3)'
                                }}
                            />
                            <Stack gap={6}>
                                <Group gap="xs">
                                    <Text fw={700} size="lg">{post.author.name}</Text>
                                    <Badge variant="filled" color="violet" size="sm">âœ“ ì¸ì¦ë¨</Badge>
                                </Group>
                                <Text size="sm" c="dimmed">{post.author.bio}</Text>
                                <Group gap="lg">
                                    <Group gap={6}>
                                        <IconCalendar size={16} />
                                        <Text size="sm" c="dimmed">{post.publishedAt}</Text>
                                    </Group>
                                    <Group gap={6}>
                                        <IconClock size={16} />
                                        <Text size="sm" c="dimmed">{post.readTime}</Text>
                                    </Group>
                                    <Group gap={6}>
                                        <IconEye size={16} />
                                        <Text size="sm" c="dimmed">{post.views.toLocaleString()}íšŒ</Text>
                                    </Group>
                                </Group>
                            </Stack>
                        </Group>

                        <Stack align="center" gap={8}>
                            <Button
                                variant="gradient"
                                gradient={{ from: 'violet', to: 'blue' }}
                                size="md"
                                style={{ minWidth: '120px' }}
                            >
                                íŒ”ë¡œìš°
                            </Button>
                            <Text size="sm" c="dimmed" fw={500}>{post.author.followers} íŒ”ë¡œì›Œ</Text>
                        </Stack>
                    </Group>
                </Card>

                {/* í¬ìŠ¤íŠ¸ ì½˜í…ì¸  */}
                <Stack gap="xl" id="content">
                    <section id="intro">
                        <Text size="xl" fw={700} mb="lg"
                              style={{
                                  background: 'linear-gradient(135deg, var(--mantine-color-violet-6), var(--mantine-color-blue-6))',
                                  backgroundClip: 'text',
                                  WebkitBackgroundClip: 'text',
                                  color: 'transparent'
                              }}
                        >
                            ë“¤ì–´ê°€ë©°
                        </Text>
                        <Text size="lg" style={{ lineHeight: 1.8 }}>
                            2025ë…„, ì›¹ ë””ìì¸ ì—…ê³„ëŠ” ì „ë¡€ì—†ëŠ” ë³€í™”ì˜ ì¤‘ì‹¬ì— ì„œ ìˆìŠµë‹ˆë‹¤.
                            ë°˜ë””ìì¸ê³¼ ì‹¤í—˜ì  ë‚´ë¹„ê²Œì´ì…˜ë¶€í„°
                            AI ê¸°ë°˜ ê°œì¸í™”ì™€ ì§€ì†ê°€ëŠ¥í•œ ë””ìì¸ê¹Œì§€,
                            ìƒˆë¡œìš´ íŒ¨ëŸ¬ë‹¤ì„ì´ ì‚¬ìš©ì ê²½í—˜ì˜ ë¯¸ë˜ë¥¼ ì¬ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                        </Text>
                    </section>

                    <Divider variant="dashed" />

                    <section id="overview">
                        <Text size="xl" fw={700} mb="lg"
                              style={{
                                  background: 'linear-gradient(135deg, var(--mantine-color-violet-6), var(--mantine-color-blue-6))',
                                  backgroundClip: 'text',
                                  WebkitBackgroundClip: 'text',
                                  color: 'transparent'
                              }}
                        >
                            2025ë…„ í•µì‹¬ íŠ¸ë Œë“œ ê°œìš”
                        </Text>
                        <Stack gap="lg">
                            <Text size="lg" style={{ lineHeight: 1.8 }}>
                                ë§ˆì´í¬ë¡œ ì• ë‹ˆë©”ì´ì…˜ê³¼ ì»¤ìŠ¤í…€ ì»¤ì„œëŠ” ë‹¨ìˆœí•œ ì¥ì‹ì„ ë„˜ì–´
                                ë¸Œëœë“œ ìš”ì†Œë¡œ ì§„í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìë“¤ì€ ë” ì´ìƒ ì •ì ì¸ ì›¹ì‚¬ì´íŠ¸ì— ë§Œì¡±í•˜ì§€ ì•Šìœ¼ë©°,
                                ì¸í„°ë™í‹°ë¸Œí•˜ê³  ëª°ì…ì ì¸ ê²½í—˜ì„ ê¸°ëŒ€í•©ë‹ˆë‹¤.
                            </Text>

                            <Paper p="xl" style={{
                                background: computedColorScheme === 'light'
                                    ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 69, 19, 0.05))'
                                    : 'linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 69, 19, 0.1))',
                                borderRadius: '16px',
                                border: computedColorScheme === 'light'
                                    ? '1px solid rgba(99, 102, 241, 0.2)'
                                    : '1px solid rgba(99, 102, 241, 0.3)'
                            }}>
                                <Text size="lg" style={{ lineHeight: 1.8 }}>
                                    ê°€ì‹œì  ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒê³¼
                                    3D ìš”ì†Œì˜ ì ‘ê·¼ì„± í–¥ìƒì€
                                    ë””ìì´ë„ˆë“¤ì—ê²Œ ìƒˆë¡œìš´ ì°½ì‘ì˜ ììœ ë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.
                                </Text>
                            </Paper>
                        </Stack>
                    </section>

                    <Divider variant="dashed" />

                    <section id="examples">
                        <Text size="xl" fw={700} mb="lg"
                              style={{
                                  background: 'linear-gradient(135deg, var(--mantine-color-violet-6), var(--mantine-color-blue-6))',
                                  backgroundClip: 'text',
                                  WebkitBackgroundClip: 'text',
                                  color: 'transparent'
                              }}
                        >
                            ì‹¤ì œ ì ìš© ì‚¬ë¡€
                        </Text>
                        <Stack gap="lg">
                            <Paper
                                p="xl"
                                style={{
                                    background: computedColorScheme === 'light'
                                        ? 'rgba(249, 250, 251, 0.9)'
                                        : 'rgba(40, 40, 40, 0.9)',
                                    borderRadius: '16px',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(0, 0, 0, 0.05)'
                                        : '1px solid rgba(255, 255, 255, 0.05)',
                                    transition: 'all 0.3s ease'
                                }}
                            >
                                <Text fw={700} mb="md" size="lg" c="violet">ìŠ¤í¬ë¡¤ ê¸°ë°˜ ìŠ¤í† ë¦¬í…”ë§</Text>
                                <Text size="md" style={{ lineHeight: 1.7 }}>
                                    ìŠ¤í¬ë¡¤í…”ë§ì€ ë‹¨ìˆœí•œ ì œí’ˆ ë¸Œë¡œì…”ë¥¼ ë„˜ì–´ ì œí’ˆ ëª¨í—˜ìœ¼ë¡œ ì§„í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                                    íŒ¨ëŸ´ë™ìŠ¤ ìŠ¤í¬ë¡¤ë§ê³¼ ì¤Œ ì¸ íš¨ê³¼ë¥¼ í†µí•´ ë”ìš± ëª°ì…ì ì¸ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.
                                </Text>
                            </Paper>

                            <Paper
                                p="xl"
                                style={{
                                    background: computedColorScheme === 'light'
                                        ? 'rgba(249, 250, 251, 0.9)'
                                        : 'rgba(40, 40, 40, 0.9)',
                                    borderRadius: '16px',
                                    border: computedColorScheme === 'light'
                                        ? '1px solid rgba(0, 0, 0, 0.05)'
                                        : '1px solid rgba(255, 255, 255, 0.05)',
                                    transition: 'all 0.3s ease'
                                }}
                            >
                                <Text fw={700} mb="md" size="lg" c="green">ì§€ì†ê°€ëŠ¥í•œ ì›¹ ë””ìì¸</Text>
                                <Text size="md" style={{ lineHeight: 1.7 }}>
                                    2025ë…„ ì›¹ ì§€ì†ê°€ëŠ¥ì„±ì€ ê¸°ë³¸ ìµœì í™”ë¥¼ ë„˜ì–´ í™˜ê²½ ì¹œí™”ì  ì›¹ì‚¬ì´íŠ¸ ì°½ì¡°ì— ì§‘ì¤‘í•©ë‹ˆë‹¤.
                                    ì´ëŠ” ë” ë¹ ë¥´ê³  íš¨ìœ¨ì ì¸ ì›¹ì‚¬ì´íŠ¸ë¡œ ì´ì–´ì ¸ ì‚¬ìš©ì ê²½í—˜ê³¼ í™˜ê²½ ì±…ì„ì˜ ì™„ë²½í•œ ì¡°í™”ë¥¼ ì´ë£¹ë‹ˆë‹¤.
                                </Text>
                            </Paper>
                        </Stack>
                    </section>

                    <Divider variant="dashed" />

                    <section id="conclusion">
                        <Text size="xl" fw={700} mb="lg"
                              style={{
                                  background: 'linear-gradient(135deg, var(--mantine-color-violet-6), var(--mantine-color-blue-6))',
                                  backgroundClip: 'text',
                                  WebkitBackgroundClip: 'text',
                                  color: 'transparent'
                              }}
                        >
                            ë§ˆë¬´ë¦¬
                        </Text>
                        <Text size="lg" style={{ lineHeight: 1.8 }}>
                            2025ë…„ ì›¹ ë””ìì¸ íŠ¸ë Œë“œëŠ” ì „í†µì ì¸ ê·œì¹™ì„ ê¹¨ëœ¨ë¦¬ëŠ” ê²ƒì— ê´€í•œ ê²ƒì…ë‹ˆë‹¤.
                            í•˜ì§€ë§Œ ì´ëŸ¬í•œ í˜ì‹ ì€ í•­ìƒ ì‚¬ìš©ì ì¤‘ì‹¬ì ì´ì–´ì•¼ í•˜ë©°, ì ‘ê·¼ì„±ê³¼ ì‚¬ìš©ì„±ì„ í¬ìƒí•˜ì§€ ì•ŠëŠ” ì„ ì—ì„œ ì´ë£¨ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤.
                        </Text>
                    </section>

                    <Divider variant="dashed" />

                    {/* íƒœê·¸ ì„¹ì…˜ */}
                    <Group gap="md" justify="center">
                        {post.tags.map((tag) => (
                            <Badge
                                key={tag}
                                variant="gradient"
                                gradient={{ from: 'violet', to: 'blue' }}
                                size="lg"
                                style={{ padding: '8px 16px', fontSize: '14px' }}
                            >
                                #{tag}
                            </Badge>
                        ))}
                    </Group>

                    <Divider size="md" />

                    {/* ëŒ“ê¸€ ì„¹ì…˜ */}
                    <section id="comments">
                        <Group justify="space-between" align="center" mb="xl">
                            <Text size="2rem" fw={700}
                                  style={{
                                      background: 'linear-gradient(135deg, var(--mantine-color-violet-6), var(--mantine-color-blue-6))',
                                      backgroundClip: 'text',
                                      WebkitBackgroundClip: 'text',
                                      color: 'transparent'
                                  }}
                            >
                                ëŒ“ê¸€
                            </Text>
                            <Group gap={8}>
                                <IconMessageCircle size={20} color="var(--mantine-color-violet-6)" />
                                <Text size="lg" fw={600} c="violet">{comments.length}ê°œ</Text>
                            </Group>
                        </Group>

                        {/* ëŒ“ê¸€ ì…ë ¥ í¼ */}
                        <CommentForm onSubmit={handleCommentSubmit} />

                        {/* ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ */}
                        <Stack gap="lg">
                            {comments.map((comment) => (
                                <Comment
                                    key={comment.id}
                                    comment={comment}
                                    onReply={handleReply}
                                />
                            ))}
                        </Stack>

                        {/* ë” ë§ì€ ëŒ“ê¸€ ë³´ê¸° */}
                        <Group justify="center" mt="xl">
                            <Button
                                variant="outline"
                                size="lg"
                                style={{
                                    borderColor: 'var(--mantine-color-violet-6)',
                                    color: 'var(--mantine-color-violet-6)'
                                }}
                            >
                                ë” ë§ì€ ëŒ“ê¸€ ë³´ê¸° (15ê°œ ë‚¨ìŒ)
                            </Button>
                        </Group>
                    </section>
                </Stack>
            </Container>

            {/* í¬ìŠ¤íŠ¸ ë„¤ë¹„ê²Œì´í„° */}
            <PostNavigator
                currentProgress={scrollProgress}
                onScrollTo={handleScrollTo}
            />

            {/* í”Œë¡œíŒ… ì•¡ì…˜ ë²„íŠ¼ë“¤ */}
            <FloatingActions />
        </Box>
    );
}